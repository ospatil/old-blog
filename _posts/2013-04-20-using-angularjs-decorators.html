---
layout: post
title: Using AngularJS Decorators
date: '2013-04-20T20:55:00.000+05:30'
author: Omkar Patil
tags:
- js
- javascript
- angularjs
modified_time: '2013-04-20T20:55:12.601+05:30'
blogger_id: tag:blogger.com,1999:blog-3599227544422363853.post-8083006760049407169
blogger_orig_url: http://blog.omkarpatil.com/2013/04/using-angularjs-decorators.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><p>Ever wondered about intercepting an Angular service creation to add behavior to the service instance that is being returned or replace it with something else altogether? Well, you don't have to do anything fancy for that, this mechanism is built right into Angular :). The <a href="http://docs.angularjs.org/api/AUTO.$provide">$provide</a> service, along with other types of providers such as factory, service, value etc, supports decorators too. While you can find decorator usage in <em>angular-mocks.js</em>, examples are a bit difficult to find in general. Hence this post :).</p><p>Let's consider a contrived scenario. HTML5 brings FileSystem API to browser, but support for it in browsers varies. I'm on latest Chrome (Chrome 26) and it supports it but none of the other browsers do. Let's say we need a simple data storage functionality in our Angular application which stores data in file system if it's available or in sessionStorage if it's not.    <br /></p><p>Here is the full working plunk that demonstrates decorator usage.</p><iframe style="width: 100%; height: 300px" src="http://embed.plnkr.co/uBkuUi" frameborder="0" allowfullscreen="allowfullscreen"></iframe><br /><p>You'll find two providers registered in above example -<br /><ol><li><em>storageServiceFile</em> - Stores data in File System</li><li><em>storageService</em> - Stores data in sessionStorage</li></ol>Now comes the decorator part. Here is how it looks like - <br /><pre class="brush: js">app.config(function($provide) {<br />  $provide.decorator('storageService', <br />   ['$delegate', '$injector', '$rootScope', 'fileSystem', <br />  function ($delegate, $injector, $rootScope, fileSystem) {<br />      if (fileSystem.requestFileSystem) {<br />        $rootScope.isFileSystemSupported = true;<br />        return $injector.get('storageServiceFile');<br />      } else {<br />       $rootScope.isFileSystemSupported = false;<br />       return $delegate;<br />      }<br />   }]);<br />});<br />...<br />...<br />...<br />app.controller('MainCtrl', ['$scope', 'storageService', function($scope, storageService) {<br />...<br />...<br /></pre>Points worth noting are - <br /><ul><li>In the config callback function, <em>$provide</em> service has been injected and a decorator is registered.</li><li>A decorator is just like any other provider. You can inject whatever than can be injected into a provider including user-defined services. In the example above, <em>fileSystem</em> is a user-defined service that has been injected into the decorator.</li><li>The <em>$delegate</em> argument to the decorator function is the actual service instance which it can choose to return as is, monkey-patch or replace altogether.</li><li>In the example above, the decorator returns instance of <em>storageServiceFile</em> service if FileSystem is supported by the browser else returns the original <em>storageService</em> instance which stores data in sessionStorage.</li><li>At runtime, the decorator comes into picture when Angular instantiates <em>MainCtrl</em>, finds out it has dependency on <em>storageService</em>, instantiates it and finds there is a decorator for this service and invokes it before the service instance is handed to the controller.</li></ul></p><p>If you play with the plunk in latest Chrome, you can see data being stored in file system and for Firefox and others, in sessionStorage.</p></div>